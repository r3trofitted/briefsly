/**
 * Temporary resets
 * TODO: remove after global overhaul
 */
body {
  margin-inline: 0;

  /* warm greys */
  --clr-neutral-100: hsl(30, 33%, 99%); /* white */
  --clr-neutral-200: hsl(45, 29%, 97%); /* bg light mode */
  --clr-neutral-400: hsl(45, 4%, 65%);
  --clr-neutral-700: hsl(45, 7%, 34%);  /* bg dark mode */
  --clr-neutral-900: hsl(44, 100%, 3%); /* black */

  /* cream, caramel and chocolate */
  --clr-primary-100: hsl(49, 81%, 88%);
  --clr-primary-400: hsl(38, 62%, 47%);
  --clr-primary-700: hsl(38, 50%, 35%);
  --clr-primary-900: hsl(37, 26%, 23%);
  
  /* teals and blues */
  --clr-secondary-100: hsl(184, 59%, 70%);
  --clr-secondary-400: hsl(184, 59%, 54%);
  --clr-secondary-700: hsl(186, 79%, 42%);
  --clr-secondary-900: hsl(186, 79%, 20%);
  
  /* pinks */
  --clr-tertiary-100: hsl(315, 59%, 70%);
  --clr-tertiary-400: hsl(315, 59%, 54%);
  --clr-tertiary-700: hsl(315, 79%, 42%);
  --clr-tertiary-900: hsl(315, 79%, 20%);

  --ff-body: ui-rounded, 'Hiragino Maru Gothic ProN', Quicksand, Comfortaa, Manjari, 'Arial Rounded MT', 'Arial Rounded MT Bold', Calibri, source-sans-pro, sans-serif;
  --ff-heading: Rockwell, 'Rockwell Nova', 'Roboto Slab', 'DejaVu Serif', 'Sitka Small', serif;
  
  --fs-500: 1.333rem;
  --fs-600: 1.763rem;
  --fs-700: 2.369rem;
  --fs-800: 3rem;
  
  background-color: var(--clr-neutral-200);
  
  font-family: var(--ff-body);
}

#open-a-slot {
  max-width: unset;
  padding-inline: 0;
}

/**
 * Reusable stuff
 */
.search-bar {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5em;
  
  & input {
    background-color: var(--clr-neutral-100);
    width: 30ch;
    max-width: 30ch;
    border: solid 1px var(--clr-secondary-700);
    padding: 0.4rem 0.75rem;
    border-radius: .5rem 0 0 .5rem;
    margin-right: 0;
    
    &:focus-visible {
      outline: none;
      background-color: var(--clr-primary-100);
    }
  }
  
  & button {
    background: var(--clr-neutral-100);
    border: solid 1px var(--clr-secondary-700);
    border-left: 0;
    padding: 0.4rem 0.75rem;
    border-radius: 0 .5rem .5rem 0;
    margin-left: 0;
  }
  
  & button > span.reverso {
    display: inline-block;
    transform: rotate3d(0, 1, 0, 180deg);
    transition: transform 300ms;
  }
  
  & input:not(:placeholder-shown) ~ button > span.reverso {
    transform: rotate3d(0, 1, 0, 0deg);
  }
}

input:is(.text-input, .submit-button) {
  padding: 0.25em;
  
  border: 2px solid var(--clr-secondary-700);
  border-radius: 1em / 50%;
  
  background-color: var(--clr-neutral-100);
}

label:has(+ .text-input) {
  color: var(--clr-neutral-200);
  font-weight: 500;
}

input[type='submit'].submit-button {
  margin-block: 1em;
  padding: .65em .5em .25em; /* insert room for the rounded border + extra padding on top to offset the font's baseline */
  
  height: min-content;
  width: min-content;
  
  color: var(--clr-secondary-700);
  font-family: var(--ff-heading);
  
  border-width: 3px;
  
  &:hover {
    background-color: var(--clr-primary-100);
  }
}

header:has(nav) {
  background-color: var(--clr-neutral-200);
  box-shadow: 0 .75rem 1rem -1rem var(--clr-primary-900);
  padding-block: .5em;
  color: var(--clr-primary-400);
  
  & a {
    color: var(--clr-neutral-900) !important; /* TODO: do without the !important */
  }
}

h1.page-title {
  position: relative;
    
  display: grid;
  grid-template-columns: 1fr 3fr 1fr;
  gap: 0.125em;
  place-content: center;
  
  margin: 1em auto;
  max-width: max-content;
  min-height: 2em;
  padding: .25em; /* leaving room for the rounded borders */
  
  border: 3px solid var(--clr-secondary-700);
  border-radius: 1em / 50%;
  background: var(--clr-neutral-100);
  
  font-size: var(--fs-800);
  font-family: var(--ff-heading);
  text-align: center;
  color: var(--clr-secondary-400);
  
  isolation: isolate;
  
  &::before,
  &::after {
    content: '';
    
    background: url('briefs.webp') center/contain no-repeat;
    
    opacity: .75;
    rotate: -15deg;
    z-index: -1;
  }
  
  &::after {
    rotate: 15deg;
  }
  
  & span {
    margin-top: .125em; /* offsetting the font's high baseline */
  }
  
  & span::before {
    content: '';
    position: absolute;
    inset: 0;
    
    border-radius: 10% / 50%;
    z-index: -2;
    
    background: var(--clr-secondary-100);
    -webkit-mask: url('tartan.svg') repeat;
    mask: url('tartan.svg') repeat;
    opacity: .5;
  }
}

/**
 * Page-specific stuff
 */

#slot-form {
  display: grid;
  grid-template-columns: 1fr;
  
  align-items: stretch;
}

.slot-form-step {
  --_step-default-bg-clr: var(--clr-neutral-200);
  --_card-border-clr: var(--clr-primary-400);
  --_card-shadow-clr: color-mix(in oklab, var(--clr-neutral-900) 30%, transparent);
  --_card-checked-border-clr: var(--clr-primary-700);
  --_card-checked-bg-clr: var(--clr-primary-100);
  
  position: relative;
  padding: 1em 1em 0;
  
  background-color: var(--_step-bg-clr, var(--_step-default-bg-clr));
  
  & legend {
    /* The legend has to be floated (or absolute-positioned) to ensure that the ::before element 
    is **really** the very first in the fieldset */
    float: left;
    clear: both;
    
    width: 100%;
    
    font-family: var(--ff-heading);
    font-size: var(--fs-700);
    text-align: left;
    
    color: var(--clr-primary-100);
    -webkit-text-stroke: 1px var(--clr-primary-400);
  }
  
  &:nth-of-type(2n + 1) {
    --_step-bg-clr: var(--clr-secondary-100);
    --_card-border-clr: var(--clr-secondary-400);
    --_card-shadow-clr: color-mix(in oklab, var(--clr-secondary-900) 50%, transparent);
    --_card-checked-border-clr: var(--clr-secondary-700);
    --_card-checked-bg-clr: var(--clr-secondary-400);

    --wave-factor: 15%;
    
    padding-top: calc(40px + 1em); /* extra space for the waves on top */
  }
  
  &:nth-of-type(2n + 1):not(:last-of-type) {
    padding-bottom: calc(40px + 1em); /* extra space for the waves on bottom */
  }
  
  &:nth-of-type(2n + 1)::before, 
  &:nth-of-type(2n + 1):not(:last-of-type)::after {
    position: absolute;
    content: '';
    width: 100%;
    height: 40px;
    left: 0;
    
    background: var(--_step-default-bg-clr);
    -webkit-mask-image: url(waves.svg);
    mask-image: url(waves.svg);
  }
  
  &:nth-of-type(2n + 1)::before {
    top: 0;
    
    -webkit-mask-size: calc(100% + var(--wave-factor));
    mask-size: calc(100% + var(--wave-factor));
  }
  
  &:nth-of-type(2n + 1):not(:last-of-type)::after {
    bottom: 0;
    
    -webkit-mask-size: calc(90% + (1.5 * var(--wave-factor)));
    mask-size: calc(90% + (1.5 * var(--wave-factor)));
    transform: rotate(.5turn);
  }
  
  /* 3, 5, 7, 9*/
  &:nth-of-type(2n + 3) {
    --wave-factor: 35%;
  }
  
  /* 5, 7, etc. */
  &:nth-of-type(2n + 5) {
    --wave-factor: 55%;
  }
  
  &:nth-of-type(2n + 7) {
    --wave-factor: 75%;
  }
}

.slot-form-step-main {
  clear: both;
  padding-top: 1em;
  
  /* Laying a shape over the list when it is a placeholder */ 
  &:has(ul.checkable-cards-list.placeholder) {
    position: relative;
    
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 1;
      
      background-color: var(--_step-bg-clr, var(--_step-default-bg-clr)); /* OPTIMIZE: use a darker, but alpha-ized, color? */
      -webkit-mask: url('briefs.svg') center 30%/55% repeat-y;
      mask: url('briefs.svg') center 30%/55% repeat-y;
    }
  }
}

#slot-form-step2 .checkable-cards-list {
  grid-template-columns: repeat(auto-fit, minmax(35ch, 1fr));
}

#slot-form-step3 {
  .slot-form-step-main {
    display: grid;
    grid-template-columns: auto 1fr;
    gap: 1em;
    justify-content: left;
    place-items: center start;
  }
  
  .submit-button {
    grid-column: 1 / -1;
    justify-self: center;
    padding-inline: 3em;
  }
}

.checkable-cards-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(25ch, 1fr));
  grid-auto-rows: minmax(4em, 1fr);
  gap: 1em;
  
  padding: 0;
  
  list-style: none;
}

.checkable-card { 
  display: block;
  height: 100%;
  
  overflow: hidden;
  
  background-color: var(--clr-neutral-100);
  border-radius: .5rem;
  border: solid 1px var(--_card-border-clr);
  box-shadow: 0 0.125rem 0.375rem var(--_card-shadow-clr);
  
  & label {
    display: block;
    
    width: 100%;
    height: 100%;
    padding: 0.5em;
  }
  
  & input[type="radio"] {
    clip: rect(0 0 0 0);
    clip-path: inset(100%);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
  }
  
  &:has(input:checked) {
    border-color: var(--_card-checked-border-clr) !important;
    background-color: var(--_card-checked-bg-clr);
  }
}

/* Redrawing the borders and box shadow _over_ the card of placeholder cards 
   so that the overlayed shape doesn't show through */
.checkable-cards-list.placeholder .checkable-card {
  position: relative;
  
  border: unset;
  box-shadow: unset;
  overflow: unset;
  
  background-color: #fff; /* to increase the contrast with the overlayed shape */
  
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    
    background-color: transparent;
    
    border-radius: .5rem;
    border: solid 1px var(--_card-border-clr);
    box-shadow: 0 0.125rem 0.375rem var(--_card-shadow-clr);
    
    z-index: 2;
  }
}

/**
 * Alternatives for browser support
 */
@supports not (-webkit-text-stroke-width: 1px) {
  .slot-form-step legend {
    text-shadow:
      -1px -1px 0 var(--clr-primary-400),
      1px -1px 0 var(--clr-primary-400),
      -1px 1px 0 var(--clr-primary-400),
      1px 1px 0 var(--clr-primary-400);
    }
  }
}
