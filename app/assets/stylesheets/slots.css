/**
 * Temporary resets
 * TODO: remove after global overhaul
 */
body {
  margin-inline: 0;

  --clr-white: #fff;
  --clr-black: hsl(37 26% 23%); /* TODO: even darker? */

  /* cream to chocolate */
  --clr-neutral-100: hsl(37 99% 99%);
  --clr-neutral-200: #FAF9F6;
  --clr-neutral-400: hsl(49 81% 88%);
  --clr-neutral-800: hsl(37 26% 23%); /* TODO: black */

  /* teals and blues */
  --clr-primary-200: hsl(184 59% 70%);
  --clr-primary-400: hsl(184 59% 54%);
  --clr-primary-600: hsl(186 79% 42%);
  --clr-primary-800: hsl(186 79% 20%);
  
  /* TODO: pinks */
  --clr-secondary-400: hsl(49 81% 88%);
  --clr-secondary-800: hsl(38 62% 47%);
  
  --ff-heading: Rockwell, 'Rockwell Nova', 'Roboto Slab', 'DejaVu Serif', 'Sitka Small', serif;
  
  --fs-500: 1.333rem;
  --fs-600: 1.763rem;
  --fs-700: 2.369rem;
  --fs-800: 3rem;
}

#open-a-slot {
  max-width: unset;
  padding-inline: 0;
}

/**
 * Reusable stuff
 */
.search-bar {
  display: flex;
  justify-content: center;
  margin-bottom: 1.5em;
  
  & input {
    background-color: var(--color-white);
    width: 30ch;
    max-width: 30ch;
    border: solid 1px var(--clr-primary-600);
    padding: 0.4rem 0.75rem;
    border-radius: .5rem 0 0 .5rem;
    margin-right: 0;
    
    &:focus-visible {
      outline: none;
      background-color: var(--clr-secondary-400);
    }
  }
  
  & button {
    background: var(--color-white);
    border: solid 1px var(--clr-primary-600);
    border-left: 0;
    padding: 0.4rem 0.75rem;
    border-radius: 0 .5rem .5rem 0;
    margin-left: 0;
  }
  
  & button > span.reverso {
    display: inline-block;
    transform: rotate3d(0, 1, 0, 180deg);
    transition: transform 300ms;
  }
  
  & input:not(:placeholder-shown) ~ button > span.reverso {
    transform: rotate3d(0, 1, 0, 0deg);
  }
}

header:has(nav) {
  background-color: var(--clr-neutral-100);
  box-shadow: 0 .75rem 1rem -1rem var(--clr-neutral-800);
  padding-block: .5em;
  color: var(--clr-neutral-800);
  color: var(--clr-secondary-800);
  
  & a {
    color: var(--clr-neutral-800) !important;
  }
}

h1.page-title {
  position: relative;
    
  display: grid;
  grid-template-columns: 1fr 3fr 1fr;
  gap: 0.125em;
  place-content: center;
  
  margin: 1em auto;
  max-width: max-content;
  min-height: 2em;
  padding: .25em; /* leaving room for the rounded borders */
  
  border: 3px solid var(--clr-primary-600);
  border-radius: 10% / 50%;
  background: #fff;
  
  font-size: var(--fs-800);
  font-family: var(--ff-heading);
  text-align: center;
  color: var(--clr-primary-400);
  
  isolation: isolate;
  
  &::before,
  &::after {
    content: '';
    
    background: url('briefs.webp') center/contain no-repeat;
    
    opacity: .75;
    rotate: -15deg;
    z-index: -1;
  }
  
  &::after {
    rotate: 15deg;
  }
  
  & span {
    margin-top: .125em; /* offsetting the font's high baseline */
  }
  
  & span::before {
    content: '';
    position: absolute;
    inset: 0;
    
    border-radius: 10% / 50%;
    z-index: -2;
    
    background: var(--clr-primary-200);
    -webkit-mask: url('tartan.svg') repeat;
    mask: url('tartan.svg') repeat;
    opacity: .5;
  }
}

/**
 * Page-specific stuff
 */

#slot-form {
  display: grid;
  grid-template-columns: 1fr;
  grid-template-rows: 1fr 1fr auto;
  
  align-items: stretch;
}

.slot-form-step {
  --_step-default-bg-clr: var(--clr-neutral-200);
  --_card-border-clr: var(--clr-neutral-600);
  --_card-shadow-clr: hsl(37 26% 23% / .75); /* clr-neutral-800 w/ alpha. FIXME: avoid duplication w/ root vars */
  --_card-checked-border-clr: var(--clr-secondary-800); /* TODO: --clr-neutral-800 or 600 */
  --_card-checked-bg-clr: var(--clr-neutral-400);
  
  position: relative;
  padding: calc(40px + 1em) 1em;
  
  background-color: var(--_step-bg-clr, var(--_step-default-bg-clr));
  
  & legend {
    /* The legend has to be floated (or absolute-positioned) to ensure that the ::before element 
    is **really** the very first in the fieldset */
    float: left;
    clear: both;
    
    width: 100%;
    
    font-family: var(--ff-heading);
    font-size: var(--fs-700);
    text-align: left;
    
    color: var(--clr-neutral-400);
    -webkit-text-stroke: 1px var(--clr-secondary-800);
  }
  
  &:nth-of-type(2n + 1) {
    --_step-bg-clr: var(--clr-primary-200);
    --_card-border-clr: var(--clr-primary-600);
    --_card-shadow-clr: hsl(186 79% 20% / .75); /* clr-primary-800 w/ alpha: FIXME: avoid duplication w/ root vars */
    --_card-checked-border-clr: var(--clr-primary-600);
    --_card-checked-bg-clr: var(--clr-primary-400);

    --wave-factor: 15%;
  }
  
  &:nth-of-type(2n + 1)::before, 
  &:nth-of-type(2n + 1)::after {
    position: absolute;
    content: '';
    width: 100%;
    height: 40px;
    left: 0;
    
    background: var(--_step-default-bg-clr);
    -webkit-mask-image: url(waves.svg);
    mask-image: url(waves.svg);
  }
  
  &:nth-of-type(2n + 1)::before {
    top: 0;
    
    -webkit-mask-size: calc(100% + var(--wave-factor));
    mask-size: calc(100% + var(--wave-factor));
  }
  
  &:nth-of-type(2n + 1)::after {
    bottom: 0;
    
    -webkit-mask-size: calc(90% + (1.5 * var(--wave-factor)));
    mask-size: calc(90% + (1.5 * var(--wave-factor)));
    transform: rotate(.5turn);
  }
  
  /* 3, 5, 7, 9*/
  &:nth-of-type(2n + 3) {
    --wave-factor: 35%;
  }
  
  /* 5, 7, etc. */
  &:nth-of-type(2n + 5) {
    --wave-factor: 55%;
  }
  
  &:nth-of-type(2n + 7) {
    --wave-factor: 75%;
  }
}

.slot-form-step-main {
  clear: both;
  padding-top: 1em;
  height: 100%;
  
  /* Laying a shape over the list when it is a placeholder */ 
  &:has(ul.checkable-cards-list.placeholder) {
    position: relative;
    
    &::before {
      content: '';
      position: absolute;
      inset: 0;
      z-index: 1;
      
      background-color: var(--_step-bg-clr, var(--_step-default-bg-clr));
      mask: url('briefs.svg') center 30%/55% repeat-y;
    }
  }
}

.checkable-cards-list {
  display: grid;
  grid-template-columns: repeat(auto-fit, minmax(25ch, 1fr));
  grid-auto-rows: 4em; /* OPTIMIZE: use auto and let the card set its height? */
  gap: 1em;
  
  padding: 0;
  
  list-style: none;
}

.checkable-card { 
  display: block;
  height: 100%;
  
  overflow: hidden;
  
  background-color: var(--color-white);
  border-radius: .5rem;
  border: solid 1px var(--_card-border-clr);
  box-shadow: 0 0.125rem 0.375rem var(--_card-shadow-clr);
  
  & label {
    display: block;
    
    width: 100%;
    height: 100%;
    padding: 0.5em;
  }
  
  & input[type="radio"] {
    clip: rect(0 0 0 0);
    clip-path: inset(100%);
    height: 1px;
    overflow: hidden;
    position: absolute;
    white-space: nowrap;
    width: 1px;
  }
  
  &:has(input:checked) {
    border-color: var(--_card-checked-border-clr);
    background-color: var(--_card-checked-bg-clr);
  }
}

/* Redrawing the borders and box shadow _over_ the card of placeholder cards 
   so that the overlayed shape doesn't show through */
.checkable-cards-list.placeholder .checkable-card {
  position: relative;
  border: unset;
  box-shadow: unset;
  
  &::after {
    content: '';
    position: absolute;
    inset: 0;
    background-color: transparent;
    border-radius: .5rem;
    border: solid 1px var(--_card-border-clr);
    box-shadow: 0 0.125rem 0.375rem var(--_card-shadow-clr);
    z-index: 2;
  }
}

/**
 * Alternatives for browser support
 */
@supports not (-webkit-text-stroke-width: 1px) {
  .slot-form-step legend {
    text-shadow:
      -1px -1px 0 var(--clr-secondary-800),
      1px -1px 0 var(--clr-secondary-800),
      -1px 1px 0 var(--clr-secondary-800),
      1px 1px 0 var(--clr-secondary-800);
    }
  }
}
